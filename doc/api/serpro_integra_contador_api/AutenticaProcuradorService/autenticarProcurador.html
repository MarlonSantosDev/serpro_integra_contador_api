<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="description" content="API docs for the autenticarProcurador method from the AutenticaProcuradorService class, for the Dart programming language.">
  <title>autenticarProcurador method - AutenticaProcuradorService class - serpro_integra_contador_api library - Dart API</title>


  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
  
  <link rel="stylesheet" href="../../static-assets/github.css?v1">
  <link rel="stylesheet" href="../../static-assets/styles.css?v1">
  <link rel="icon" href="../../static-assets/favicon.png?v1">
  
</head>

<body data-base-href="../../" data-using-base-href="false" class="light-theme">
<div id="overlay-under-drawer"></div>
<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="../../index.html">serpro_integra_contador_api</a></li>
    <li><a href="../../serpro_integra_contador_api/">serpro_integra_contador_api.dart</a></li>
    <li><a href="../../serpro_integra_contador_api/AutenticaProcuradorService-class.html">AutenticaProcuradorService</a></li>
    <li class="self-crumb">autenticarProcurador method</li>
  </ol>
  <div class="self-name">autenticarProcurador</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
  <button class="toggle" id="theme-button" title="Toggle between light and dark mode" aria-label="Light and dark mode toggle">
    <span id="dark-theme-button" class="material-symbols-outlined" aria-hidden="true">
      dark_mode
    </span>
    <span id="light-theme-button" class="material-symbols-outlined" aria-hidden="true">
      light_mode
    </span>
  </button>
</header>
<main>
<div
    id="dartdoc-main-content"
    class="main-content"
    data-above-sidebar="serpro_integra_contador_api&#47;AutenticaProcuradorService-class-sidebar.html"
    data-below-sidebar="">
    <div>
<h1><span class="kind-method">autenticarProcurador</span> method 
</h1></div>

    <section class="multi-line-signature">
      
<span class="returntype"><a href="https://api.flutter.dev/flutter/dart-core/Future-class.html">Future</a><span class="signature">&lt;<wbr><span class="type-parameter"><a href="../../serpro_integra_contador_api/TermoAutorizacaoResponse-class.html">TermoAutorizacaoResponse</a></span>&gt;</span></span>
<span class="name ">autenticarProcurador</span>(<wbr>{<ol class="parameter-list"> <li><span class="parameter" id="autenticarProcurador-param-contratanteNome"><span>required</span> <span class="type-annotation"><a href="https://api.flutter.dev/flutter/dart-core/String-class.html">String</a></span> <span class="parameter-name">contratanteNome</span>, </span></li>
<li><span class="parameter" id="autenticarProcurador-param-autorNome"><span>required</span> <span class="type-annotation"><a href="https://api.flutter.dev/flutter/dart-core/String-class.html">String</a></span> <span class="parameter-name">autorNome</span>, </span></li>
<li><span class="parameter" id="autenticarProcurador-param-contribuinteNumero"><span class="type-annotation"><a href="https://api.flutter.dev/flutter/dart-core/String-class.html">String</a>?</span> <span class="parameter-name">contribuinteNumero</span>, </span></li>
<li><span class="parameter" id="autenticarProcurador-param-certificadoPath"><span class="type-annotation"><a href="https://api.flutter.dev/flutter/dart-core/String-class.html">String</a>?</span> <span class="parameter-name">certificadoPath</span>, </span></li>
<li><span class="parameter" id="autenticarProcurador-param-certificadoBase64"><span class="type-annotation"><a href="https://api.flutter.dev/flutter/dart-core/String-class.html">String</a>?</span> <span class="parameter-name">certificadoBase64</span>, </span></li>
<li><span class="parameter" id="autenticarProcurador-param-certificadoPassword"><span class="type-annotation"><a href="https://api.flutter.dev/flutter/dart-core/String-class.html">String</a>?</span> <span class="parameter-name">certificadoPassword</span>, </span></li>
<li><span class="parameter" id="autenticarProcurador-param-contratanteNumero"><span class="type-annotation"><a href="https://api.flutter.dev/flutter/dart-core/String-class.html">String</a>?</span> <span class="parameter-name">contratanteNumero</span>, </span></li>
<li><span class="parameter" id="autenticarProcurador-param-autorNumero"><span class="type-annotation"><a href="https://api.flutter.dev/flutter/dart-core/String-class.html">String</a>?</span> <span class="parameter-name">autorNumero</span>, </span></li>
</ol>})

      

    </section>
    
<section class="desc markdown">
  <p>Autentica procurador enviando XML assinado com Termo de Autorização</p>
<h2 id="parmetros-obrigatrios">Parâmetros Obrigatórios</h2>
<ul>
<li><code>contratanteNome</code>: Razão social da empresa contratante (quem faz requisições)</li>
<li><code>autorNome</code>: Nome do procurador (quem assina o termo)</li>
</ul>
<h2 id="parmetros-do-contribuinte-obrigatrio-se-diferente-do-contratante">Parâmetros do Contribuinte (obrigatório se diferente do contratante)</h2>
<ul>
<li><code>contribuinteNumero</code>: CPF/CNPJ do contribuinte (em nome de quem serão feitas as requisições)</li>
</ul>
<h2 id="certificado-de-assinatura-obrigatrio-se-diferente-do-authenticate">Certificado de Assinatura (obrigatório se diferente do authenticate)</h2>
<p>O certificado usado para <strong>assinar o termo</strong> pode ser diferente do usado na autenticação OAuth2.</p>
<p><strong>Desktop/Mobile:</strong></p>
<ul>
<li><code>certificadoPath</code>: Caminho do certificado PFX/PEM do procurador</li>
<li><code>certificadoPassword</code>: Senha do certificado do procurador</li>
</ul>
<p><strong>Web (ou todas as plataformas):</strong></p>
<ul>
<li><code>certificadoBase64</code>: Certificado PFX em Base64 (conteúdo do arquivo convertido)</li>
<li><code>certificadoPassword</code>: Senha do certificado do procurador</li>
</ul>
<h2 id="parmetros-opcionais-obtidos-do-apiclient">Parâmetros Opcionais (obtidos do ApiClient)</h2>
<ul>
<li><code>contratanteNumero</code>: CNPJ do contratante (padrão: do authenticate)</li>
<li><code>autorNumero</code>: CPF/CNPJ do procurador (padrão: do authenticate)</li>
</ul>
<h2 id="retorno">Retorno</h2>
<p><a href="../../serpro_integra_contador_api/TermoAutorizacaoResponse-class.html">TermoAutorizacaoResponse</a> contendo:</p>
<ul>
<li><code>sucesso</code>: se a autenticação foi bem-sucedida</li>
<li><code>autenticarProcuradorToken</code>: token para usar em requisições subsequentes</li>
<li><code>dataExpiracao</code>: quando o token expira</li>
<li><code>isCacheValido</code>: se está usando resposta em cache</li>
</ul>
<h2 id="erros-possveis">Erros Possíveis</h2>
<ul>
<li><a href="../../serpro_integra_contador_api/ExcecaoAssinaturaCertificado-class.html">ExcecaoAssinaturaCertificado</a>: Problema com o certificado digital</li>
<li><a href="../../serpro_integra_contador_api/ExcecaoAssinaturaXml-class.html">ExcecaoAssinaturaXml</a>: Problema na assinatura do XML</li>
<li><a href="../../serpro_integra_contador_api/ExcecaoErroSerpro-class.html">ExcecaoErroSerpro</a>: Erro retornado pela API SERPRO</li>
</ul>
</section>


    
<section class="summary source-code" id="source">
  <h2><span>Implementation</span></h2>
  <pre class="language-dart"><code class="language-dart">Future&lt;TermoAutorizacaoResponse&gt; autenticarProcurador({
  &#47;&#47; Obrigatórios: nomes
  required String contratanteNome,
  required String autorNome,
  &#47;&#47; Contribuinte: obrigatório se diferente do contratante
  String? contribuinteNumero,
  &#47;&#47; Certificado de assinatura: pode ser diferente do OAuth2
  String? certificadoPath,
  String? certificadoBase64,
  String? certificadoPassword,
  &#47;&#47; Opcionais: obtidos do ApiClient se não fornecidos
  String? contratanteNumero,
  String? autorNumero,
}) async {
  try {
    &#47;&#47; Verificar se ApiClient está autenticado
    if (!_apiClient.isAutenticado) {
      throw ExcecaoAutenticaProcurador(
        &#39;ApiClient não está autenticado. Chame authenticate() primeiro.&#39;,
        codigo: &#39;NAO_AUTENTICADO&#39;,
        statusHttp: 401,
      );
    }

    &#47;&#47; Obter dados do ApiClient (se não fornecidos)
    final finalContratanteNumero =
        contratanteNumero ?? _apiClient.contratanteNumero!;
    final finalAutorNumero =
        autorNumero ?? _apiClient.autorPedidoDadosNumero!;
    final finalContribuinteNumero =
        contribuinteNumero ?? finalContratanteNumero;

    &#47;&#47; Certificado de assinatura: pode ser diferente do OAuth2
    &#47;&#47; Prioridade: certificadoBase64 &gt; certificadoPath &gt; certificado do authenticate
    String? finalCertificadoPath;
    String? finalCertificadoBase64;
    String? finalCertificadoPassword;

    if (certificadoBase64 != null &amp;&amp; certificadoBase64.isNotEmpty) {
      &#47;&#47; Usar Base64 fornecido (funciona em todas as plataformas)
      finalCertificadoBase64 = certificadoBase64;
      finalCertificadoPassword = certificadoPassword;
    } else if (certificadoPath != null &amp;&amp; certificadoPath.isNotEmpty) {
      &#47;&#47; Usar path fornecido (Desktop&#47;Mobile)
      finalCertificadoPath = certificadoPath;
      finalCertificadoPassword = certificadoPassword;
    } else if (_apiClient.certificadoPath != null) {
      &#47;&#47; Usar certificado do authenticate
      finalCertificadoPath = _apiClient.certificadoPath;
      finalCertificadoPassword = _apiClient.certificadoSenha;
    } else {
      throw ExcecaoAssinaturaCertificado(
        &#39;Nenhum certificado fornecido para assinatura.\n&#39;
        &#39;Forneça certificadoPath (Desktop&#47;Mobile) ou certificadoBase64 (Web&#47;todas).&#39;,
      );
    }

    if (finalCertificadoPassword == null ||
        finalCertificadoPassword.isEmpty) {
      throw ExcecaoAssinaturaCertificado(
        &#39;Senha do certificado não fornecida.&#39;,
      );
    }

    &#47;&#47; 1. Criar termo de autorização
    final termo = TermoAutorizacaoRequest.comDataAtual(
      contratanteNumero: finalContratanteNumero,
      contratanteNome: contratanteNome,
      autorPedidoDadosNumero: finalAutorNumero,
      autorPedidoDadosNome: autorNome,
      certificadoPath: finalCertificadoPath,
      certificadoPassword: finalCertificadoPassword,
    );

    &#47;&#47; 2. Validar dados (transparente)
    final errosValidacao = termo.validarDados();
    if (errosValidacao.isNotEmpty) {
      throw ExcecaoAutenticaProcurador(
        &#39;Dados do termo de autorização inválidos:\n${errosValidacao.join(&#39;\n&#39;)}&#39;,
        codigo: &#39;DADOS_INVALIDOS&#39;,
        statusHttp: 400,
      );
    }

    &#47;&#47; 3. Criar XML do termo
    final xml = termo.criarXmlTermo();

    &#47;&#47; 4. Assinar digitalmente com certificado real
    final xmlAssinado = await _assinarXmlReal(
      xml,
      certificadoPath: finalCertificadoPath,
      certificadoBase64: finalCertificadoBase64,
      certificadoPassword: finalCertificadoPassword,
    );

    &#47;&#47; 5. Enviar para API e obter token
    return await _enviarParaAPI(
      xmlAssinado,
      finalContratanteNumero,
      finalAutorNumero,
      finalContribuinteNumero,
    );
  } on ExcecaoAutenticaProcurador {
    rethrow;
  } catch (e) {
    throw ExcecaoAutenticaProcurador(
      &#39;Erro na autenticação de procurador: $e&#39;,
      codigo: &#39;ERRO_INESPERADO&#39;,
      statusHttp: 500,
    );
  }
}</code></pre>
</section>


  </div> <!-- /.main-content -->
  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <!-- The search input and breadcrumbs below are only responsively visible at low resolutions. -->
<header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>
<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
    <li><a href="../../index.html">serpro_integra_contador_api</a></li>
    <li><a href="../../serpro_integra_contador_api/">serpro_integra_contador_api</a></li>
    <li><a href="../../serpro_integra_contador_api/AutenticaProcuradorService-class.html">AutenticaProcuradorService</a></li>
    <li class="self-crumb">autenticarProcurador method</li>
</ol>

    <h5>AutenticaProcuradorService class</h5>
    <div id="dartdoc-sidebar-left-content"></div>
  </div><!--/.sidebar-offcanvas-->
  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
</div><!--/.sidebar-offcanvas-->
</main>
<footer>
  <span class="no-break">
    serpro_integra_contador_api
      2.0.11
  </span>
  
</footer>


<script src="../../static-assets/highlight.pack.js?v1"></script>
<script src="../../static-assets/docs.dart.js"></script>

</body>
</html>

